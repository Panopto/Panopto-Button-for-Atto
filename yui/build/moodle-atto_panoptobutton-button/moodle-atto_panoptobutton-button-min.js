YUI.add("moodle-atto_panoptobutton-button",function(e,t){var n="atto_panoptobutton",r="",i="",s="",o="?playlistsEnabled=true";IFSOURCE=r+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx",IFHEIGHT=550,IFWIDTH=1060,IFID="pageframe",SUBMITID="submit",SELECTALIGN="float:left; display:none",CSS={INPUTSUBMIT:"atto_media_urlentrysubmit"},TEMPLATE='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>',e.namespace("M.atto_panoptobutton").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;i=this.get("coursecontext"),i&&(s="&folderID="+i);var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},_displayDialogue:function(t,i){var u=1150,a=720,f=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:u+"px",height:a+"px",focusAfterHide:i}),l,c,h,p,d,v,m;t.preventDefault(),f.after("visibleChange",function(){var e=f.getAttrs();e.visible===!1&&setTimeout(function(){f.reset()},5)}),f.width!==u+"px"&&f.set("width",u+"px"),f.height!==a+"px"&&f.set("height",a+"px"),l=this._getFormContent(i),c=e.Node.create("<div></div>"),c.append(l),h=this.get("defaultserver"),p=window.addEventListener?"addEventListener":"attachEvent",d=window[p],v=p==="attachEvent"?"onmessage":"message",d(v,function(e){var t=JSON.parse(e.data);t.cmd==="ready"&&(document.getElementById("submit").style.display="block"),t.cmd==="notReady"&&(document.getElementById("submit").style.display="none")},!1),f.set("bodyContent",c),m=this.get("servename"),m?(document.getElementById("pageframe").src="https://"+m+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+o+s,r=m):(document.getElementById("pageframe").src="https://"+h+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+o+s,r=h),f.show(),this.markUpdated()},_getFormContent:function(t){var r=e.Handlebars.compile(TEMPLATE),i=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:CSS,component:n,clickedicon:t,isource:IFSOURCE+o+s,iframeheight:IFHEIGHT,iframeID:IFID,submitid:SUBMITID,iframewidth:IFWIDTH,selectalign:SELECTALIGN}));return this._form=i,this._form.one("."+CSS.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){var t,n,i,s,o,u=this,a=!1;e.preventDefault(),t=document.getElementById("pageframe").contentWindow,n={cmd:"createEmbeddedFrame"},t.postMessage(JSON.stringify(n),"https://"+r),i=window.addEventListener?"addEventListener":"attachEvent",s=window[i],o=i==="attachEvent"?"onmessage":"message",s(o,function(e){var t,n,i,s,o,f,l=1,c=0,h;if(!a){t=JSON.parse(e.data),n="";if(t.cmd==="deliveryList"){o=t.ids,f=t.names;for(h=0;h<o.length;++h)i="<div style='position: absolute; z-index: -1;'>",t.playableObjectTypes&&parseInt(t.playableObjectTypes[h])===l?s="?pid="+o[h]:s="?id="+o[h],typeof f[h]!="undefined"&&(i+="<div width='450'><a style='max-width: 450px; display: inline-block;text-overflow: ellipsis; white-space: nowrap; overflow: hidden;'href='https://"+r+"/Panopto/Pages/Viewer.aspx"+s+"' target='_blank'>"+f[h]+"</a></div>"),i+="<a href='https://"+r+"/Panopto/Pages/Viewer.aspx"+s+"' target='_blank'>"+"<img width='128' height='72' src='https://"+r+"/Panopto/PublicAPI/SessionPreviewImage?id="+o[h]+"'></img></a><br></div>",n+="<div style='position: relative;'>"+i+"<div>"+"<iframe src='https://"+r+"/Panopto/Pages/Embed.aspx"+s+"&v=1' width='450' height='300' frameborder='0' allowfullscreen></iframe><br></div>"+"</div>";u.getDialogue({focusAfterHide:null}).hide(),u.editor.focus(),u.get("host").insertContentAtFocusPoint(n),u.markUpdated()}a=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
