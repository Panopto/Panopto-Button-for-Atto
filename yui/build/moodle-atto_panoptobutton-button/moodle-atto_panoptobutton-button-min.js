YUI.add("moodle-atto_panoptobutton-button",function(l,e){var t,i,u="atto_panoptobutton",m="",c="",p="",h="?playlistsEnabled=true",g="",s={INPUTSUBMIT:"atto_media_urlentrysubmit"};l.namespace("M.atto_panoptobutton").Button=l.Base.create("button",l.M.editor_atto.EditorPlugin,[],{initializer:function(){var e;this.get("disabled")||((t=this.get("coursecontext"))&&(c="&folderID="+t),(i=this.get("instancename"))&&(p="&instance="+i),e="iconone",this.addButton({icon:"ed/"+e,iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e}))},_displayDialogue:function(e,t){var i,a,n,s,o,d=1150,r=this.getDialogue({headerContent:M.util.get_string("dialogtitle",u),width:d+"px",height:"720px",focusAfterHide:t});e.preventDefault(),r.after("visibleChange",function(){!1===r.getAttrs().visible&&setTimeout(function(){r.reset()},5)}),r.width!==d+"px"&&r.set("width",d+"px"),"720px"!==r.height&&r.set("height","720px"),i=this._getFormContent(t),(a=l.Node.create("<div></div>")).append(i),n=this.get("defaultserver"),s=window.addEventListener?"addEventListener":"attachEvent",(0,window[s])("attachEvent"==s?"onmessage":"message",function(e){var t=JSON.parse(e.data);"ready"===t.cmd&&(document.getElementById("submit").style.display="block"),"notReady"===t.cmd&&(document.getElementById("submit").style.display="none")},!1),r.set("bodyContent",a),o=this.get("servename"),g="https://"+(m=o||n)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+h+p+c,document.getElementById("pageframe").src=g,r.show(),this.markUpdated()},_getFormContent:function(e){var t,i,a=this.get("defaultserver"),n=this.get("servename");return g="https://"+(m=n||a)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+h+p+c,t=l.Handlebars.compile('<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>'),i=l.Node.create(t({elementid:this.get("host").get("elementid"),CSS:s,component:u,clickedicon:e,isource:g,iframeheight:550,iframeID:"pageframe",submitid:"submit",iframewidth:1060,selectalign:"float:left; display:none"})),this._form=i,this._form.one("."+s.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){var t,i,c=this,h=!1;e.preventDefault(),t={cmd:"createEmbeddedFrame"},document.getElementById("pageframe").contentWindow.postMessage(JSON.stringify(t),"https://"+m),i=window.addEventListener?"addEventListener":"attachEvent",(0,window[i])("attachEvent"==i?"onmessage":"message",function(e){var t,i,a,n,s,o,d,r,l,u=1;if(!h){if(i="","deliveryList"===(t=JSON.parse(e.data)).cmd){for(s=t.ids,o=t.names,d=0;d<s.length;++d)r=null===t.width[d]?450:t.width[d],l=null===t.height[d]?300:t.height[d],a="<div style='position: absolute; z-index: -1;'>",n=t.playableObjectTypes&&parseInt(t.playableObjectTypes[d])===u?"?pid="+s[d]:"?id="+s[d],"undefined"!=typeof o[d]&&(a+="<div width='"+r+"'><a style='max-width: "+r+"px; display: inline-block;text-overflow: ellipsis; white-space: nowrap; overflow: hidden;'href='https://"+m+"/Panopto/Pages/Viewer.aspx"+n+p+"' target='_blank'>"+o[d]+"</a></div>"),i+="<div style='position: relative;'>"+(a+="<a href='https://"+m+"/Panopto/Pages/Viewer.aspx"+n+"' target='_blank'><img width='128' height='72' alt='"+o[d]+"' src='https://"+m+"/Panopto/PublicAPI/SessionPreviewImage?id="+s[d]+"'></img></a><br></div>")+"<div><iframe src='https://"+m+"/Panopto/Pages/Embed.aspx"+n+p+"&v=1' width='"+r+"' height='"+l+"' frameborder='0' allowfullscreen></iframe><br></div></div>";c.getDialogue({focusAfterHide:null}).hide(),c.editor.focus(),c.get("host").insertContentAtFocusPoint(i),c.markUpdated()}h=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},instancename:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});