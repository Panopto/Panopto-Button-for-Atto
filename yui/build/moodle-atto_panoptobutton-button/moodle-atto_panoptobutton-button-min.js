YUI.add("moodle-atto_panoptobutton-button",function(e,t){var n="atto_panoptobutton",r="",i="",s="",o=r+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx",u=550,a=1060,f="pageframe",l="submit",c="float:left; display:none",h={INPUTSUBMIT:"atto_media_urlentrysubmit"},p='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>';e.namespace("M.atto_panoptobutton").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;i=this.get("coursecontext"),i&&(s="?folderID="+i);var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},_displayDialogue:function(t,i){var o=1150,u=720,a=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:o+"px",height:u+"px",focusAfterHide:i}),f,l,c,h,p,d,v;t.preventDefault(),a.after("visibleChange",function(){var e=a.getAttrs();e.visible===!1&&setTimeout(function(){a.reset()},5)}),a.width!==o+"px"&&a.set("width",o+"px"),a.height!==u+"px"&&a.set("height",u+"px"),f=this._getFormContent(i),l=e.Node.create("<div></div>"),l.append(f),c=this.get("defaultserver"),h=window.addEventListener?"addEventListener":"attachEvent",p=window[h],d=h==="attachEvent"?"onmessage":"message",p(d,function(e){var t=JSON.parse(e.data);t.cmd==="ready"&&(document.getElementById("submit").style.display="block"),t.cmd==="notReady"&&(document.getElementById("submit").style.display="none")},!1),a.set("bodyContent",l),v=this.get("servename"),v?(document.getElementById("pageframe").src="https://"+v+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+s,r=v):(document.getElementById("pageframe").src="https://"+c+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+s,r=c),a.show(),this.markUpdated()},_getFormContent:function(t){var r=e.Handlebars.compile(p),i=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:h,component:n,clickedicon:t,isource:o+s,iframeheight:u,iframeID:f,submitid:l,iframewidth:a,selectalign:c}));return this._form=i,this._form.one("."+h.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){var t,n,i,s,o,u=this,a=!1;e.preventDefault(),t=document.getElementById("pageframe").contentWindow,n={cmd:"createEmbeddedFrame"},t.postMessage(JSON.stringify(n),"https://"+r),i=window.addEventListener?"addEventListener":"attachEvent",s=window[i],o=i==="attachEvent"?"onmessage":"message",s(o,function(e){var t,n,i,s,o,f;if(!a){t=JSON.parse(e.data),n="";if(t.cmd==="deliveryList"){s=t.ids,o=t.names;for(f=0;f<s.length;++f)i="<div style='position: absolute; z-index: -1;'>",typeof o[f]!="undefined"&&(i+="<div width='450'><a style='max-width: 450px; display: inline-block;text-overflow: ellipsis; white-space: nowrap; overflow: hidden;'href='https://"+r+"/Panopto/Pages/Viewer.aspx?id="+s[f]+"' target='_blank'>"+o[f]+"</a></div>"),i+="<a href='https://"+r+"/Panopto/Pages/Viewer.aspx?id="+s[f]+"' target='_blank'>"+"<img width='128' height='72' src='https://"+r+"/Panopto/PublicAPI/SessionPreviewImage?id="+s[f]+"'></img></a><br></div>",n+="<div style='position: relative;'>"+i+"<div>"+"<object data='https://"+r+"/Panopto/Pages/Embed.aspx?id="+s[f]+"&v=1' width='450' height='300' frameborder='0'></object><br></div>"+"</div>";u.getDialogue({focusAfterHide:null}).hide(),u.editor.focus(),u.get("host").insertContentAtFocusPoint(n),u.markUpdated()}a=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
