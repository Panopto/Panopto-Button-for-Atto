YUI.add("moodle-atto_panoptobutton-button",function(n,e){var t,s="atto_panoptobutton",h="",o="",m="",d="?playlistsEnabled=true",l="",a={INPUTSUBMIT:"atto_media_urlentrysubmit"};n.namespace("M.atto_panoptobutton").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{initializer:function(){var e;this.get("disabled")||((t=this.get("coursecontext"))&&(o="&folderID="+t),(t=this.get("instancename"))&&(m="&instance="+t),this.addButton({icon:"ed/"+(e="iconone"),iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e}))},_displayDialogue:function(e,t){var i=1150,a=this.getDialogue({headerContent:M.util.get_string("dialogtitle",s),width:i+"px",height:"720px",focusAfterHide:t});e.preventDefault(),a.after("visibleChange",function(){!1===a.getAttrs().visible&&setTimeout(function(){a.reset()},5)}),a.width!==i+"px"&&a.set("width",i+"px"),"720px"!==a.height&&a.set("height","720px"),e=this._getFormContent(t),(i=n.Node.create("<div></div>")).append(e),t=this.get("defaultserver"),e=window.addEventListener?"addEventListener":"attachEvent",(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){e=JSON.parse(e.data);"ready"===e.cmd&&(document.getElementById("submit").style.display="block"),"notReady"===e.cmd&&(document.getElementById("submit").style.display="none")},!1),a.set("bodyContent",i),e=this.get("servename"),l="https://"+(h=e||t)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+d+m+o,document.getElementById("pageframe").src=l,a.show(),this.markUpdated()},_getFormContent:function(e){var t=this.get("defaultserver"),i=this.get("servename");return l="https://"+(h=i||t)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+d+m+o,i=n.Handlebars.compile('<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>'),t=n.Node.create(i({elementid:this.get("host").get("elementid"),CSS:a,component:s,clickedicon:e,isource:l,iframeheight:550,iframeID:"pageframe",submitid:"submit",iframewidth:1060,selectalign:"float:left; display:none"})),this._form=t,this._form.one("."+a.INPUTSUBMIT).on("click",this._doInsert,this),t},_doInsert:function(e){var u=this,c=!1;e.preventDefault(),document.getElementById("pageframe").contentWindow.postMessage(JSON.stringify({cmd:"createEmbeddedFrame"}),"https://"+h),e=window.addEventListener?"addEventListener":"attachEvent",(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){var t,i,a,n,s,o,d,l,r;if(!c){if(i="","deliveryList"===(t=JSON.parse(e.data)).cmd){for(s=t.ids,o=t.names,d=0;d<s.length;++d)l=null===t.width[d]?450:t.width[d],r=null===t.height[d]?300:t.height[d],a="<div style='position: absolute; z-index: -1;'>",n=t.playableObjectTypes&&1===parseInt(t.playableObjectTypes[d])?"?pid="+s[d]:"?id="+s[d],"undefined"!=typeof o[d]&&(a+="<div width='"+l+"'><a style='max-width: "+l+"px; display: inline-block;text-overflow: ellipsis; white-space: nowrap; overflow: hidden;'href='https://"+h+"/Panopto/Pages/Viewer.aspx"+n+m+"' target='_blank'>"+o[d]+"</a></div>"),i+="<div style='position: relative;'>"+(a+="<a href='https://"+h+"/Panopto/Pages/Viewer.aspx"+n+"' target='_blank'><img width='128' height='72' alt='"+o[d]+"' src='https://"+h+"/Panopto/PublicAPI/SessionPreviewImage?id="+s[d]+"'></img></a><br></div>")+"<div><iframe src='https://"+h+"/Panopto/Pages/Embed.aspx"+n+m+"&v=1' width='"+l+"' height='"+r+"' frameborder='0' allowfullscreen></iframe><br></div></div>";u.getDialogue({focusAfterHide:null}).hide(),u.editor.focus(),u.get("host").insertContentAtFocusPoint(i),u.markUpdated()}c=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},instancename:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});