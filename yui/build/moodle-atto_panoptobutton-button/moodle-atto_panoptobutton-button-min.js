YUI.add("moodle-atto_panoptobutton-button",function(e,t){var n="atto_panoptobutton",r="atto_panoptobutton",i="",s="",o="",u=i+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx",a=550,f=1060,l="pageframe",c="submit",h="float:left; display:none",p={INPUTSUBMIT:"atto_media_urlentrysubmit"},d='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>';e.namespace("M.atto_panoptobutton").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;s=this.get("coursecontext"),s&&(o="?folderId="+s);var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},_displayDialogue:function(t,r){t.preventDefault();var s=1150,u=720,a=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:s+"px",height:u+"px",focusAfterHide:r});a.after("visibleChange",function(){var e=a.getAttrs();e["visible"]==0&&setTimeout(function(){a.reset()},5)}),a.width!==s+"px"&&a.set("width",s+"px"),a.height!==u+"px"&&a.set("height",u+"px");var f=this._getFormContent(r),l=e.Node.create("<div></div>");l.append(f);var c=this.get("defaultserver"),h=window.addEventListener?"addEventListener":"attachEvent",p=window[h],d=h==="attachEvent"?"onmessage":"message";p(d,function(e){var t=JSON.parse(e.data);t.cmd==="ready"&&(document.getElementById("submit").style.display="block"),t.cmd==="notReady"&&(document.getElementById("submit").style.display="none")},!1),a.set("bodyContent",l);var v=this.get("servename");v?(document.getElementById("pageframe").src="https://"+v+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+o,i=v):(document.getElementById("pageframe").src="https://"+c+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+o,i=c),a.show(),this.markUpdated()},_getFormContent:function(t){var r=e.Handlebars.compile(d),i=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:p,component:n,clickedicon:t,isource:u+o,iframeheight:a,iframeID:l,submitid:c,iframewidth:f,selectalign:h}));return this._form=i,this._form.one("."+p.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t=document.getElementById("pageframe").contentWindow,n={cmd:"createEmbeddedFrame"};t.postMessage(JSON.stringify(n),"https://"+i);var r=window.addEventListener?"addEventListener":"attachEvent",s=window[r],o=r==="attachEvent"?"onmessage":"message",u=this,a=!1;s(o,function(e){if(!a){var t=JSON.parse(e.data),n="";if(t.cmd==="deliveryList"){ids=t.ids;for(var r in ids)n+="<object type='text/html' data='https://"+i+"/Panopto/Pages/Embed.aspx?id="+ids[r]+"&v=1' width='450' height='300' frameborder='0'></object><br>";u.editor.focus(),u.get("host").insertContentAtFocusPoint(n),u.markUpdated()}a=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
