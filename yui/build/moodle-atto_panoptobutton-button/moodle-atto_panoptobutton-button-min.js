YUI.add("moodle-atto_panoptobutton-button",function(l,e){var p="atto_panoptobutton",m="",t="",u="",c="?playlistsEnabled=true",h="",o={INPUTSUBMIT:"atto_media_urlentrysubmit"};l.namespace("M.atto_panoptobutton").Button=l.Base.create("button",l.M.editor_atto.EditorPlugin,[],{initializer:function(){if(!this.get("disabled")){(t=this.get("coursecontext"))&&(u="&folderID="+t);var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_panoptobutton",buttonName:e,callback:this._displayDialogue,callbackArgs:e})}},_displayDialogue:function(e,t){var i,a,n,o,s,d=1150,r=this.getDialogue({headerContent:M.util.get_string("dialogtitle",p),width:d+"px",height:"720px",focusAfterHide:t});e.preventDefault(),r.after("visibleChange",function(){!1===r.getAttrs().visible&&setTimeout(function(){r.reset()},5)}),r.width!==d+"px"&&r.set("width",d+"px"),"720px"!==r.height&&r.set("height","720px"),i=this._getFormContent(t),(a=l.Node.create("<div></div>")).append(i),n=this.get("defaultserver"),o=window.addEventListener?"addEventListener":"attachEvent",(0,window[o])("attachEvent"===o?"onmessage":"message",function(e){var t=JSON.parse(e.data);"ready"===t.cmd&&(document.getElementById("submit").style.display="block"),"notReady"===t.cmd&&(document.getElementById("submit").style.display="none")},!1),r.set("bodyContent",a),s=this.get("servename"),h="https://"+(m=s||n)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+c+u,document.getElementById("pageframe").src=h,r.show(),this.markUpdated()},_getFormContent:function(e){var t,i,a,n;return a=this.get("defaultserver"),n=this.get("servename"),h="https://"+(m=n||a)+"/Panopto/Pages/Sessions/EmbeddedUpload.aspx"+c+u,t=l.Handlebars.compile('<div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe src="{{isource}}" id="{{iframeID}}" height="{{iframeheight}}" width="{{iframewidth}}" scrolling="auto"></iframe><br><br></div><button class="{{CSS.INPUTSUBMIT}}" id="{{submitid}}" style="{{selectalign}}">{{get_string "insert" component}}</button>'),i=l.Node.create(t({elementid:this.get("host").get("elementid"),CSS:o,component:p,clickedicon:e,isource:h,iframeheight:550,iframeID:"pageframe",submitid:"submit",iframewidth:1060,selectalign:"float:left; display:none"})),this._form=i,this._form.one("."+o.INPUTSUBMIT).on("click",this._doInsert,this),i},_doInsert:function(e){var t,i,r=this,l=!1;e.preventDefault(),t={cmd:"createEmbeddedFrame"},document.getElementById("pageframe").contentWindow.postMessage(JSON.stringify(t),"https://"+m),i=window.addEventListener?"addEventListener":"attachEvent",(0,window[i])("attachEvent"===i?"onmessage":"message",function(e){var t,i,a,n,o,s,d;if(!l){if(i="","deliveryList"===(t=JSON.parse(e.data)).cmd){for(o=t.ids,s=t.names,d=0;d<o.length;++d)a="<div style='position: absolute; z-index: -1;'>",n=t.playableObjectTypes&&1===parseInt(t.playableObjectTypes[d])?"?pid="+o[d]:"?id="+o[d],"undefined"!=typeof s[d]&&(a+="<div width='450'><a style='max-width: 450px; display: inline-block;text-overflow: ellipsis; white-space: nowrap; overflow: hidden;'href='https://"+m+"/Panopto/Pages/Viewer.aspx"+n+"' target='_blank'>"+s[d]+"</a></div>"),i+="<div style='position: relative;'>"+(a+="<a href='https://"+m+"/Panopto/Pages/Viewer.aspx"+n+"' target='_blank'><img width='128' height='72' src='https://"+m+"/Panopto/PublicAPI/SessionPreviewImage?id="+o[d]+"'></img></a><br></div>")+"<div><iframe src='https://"+m+"/Panopto/Pages/Embed.aspx"+n+"&v=1' width='450' height='300' frameborder='0' allowfullscreen></iframe><br></div></div>";r.getDialogue({focusAfterHide:null}).hide(),r.editor.focus(),r.get("host").insertContentAtFocusPoint(i),r.markUpdated()}l=!0}},!1)}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultserver:{value:""},coursecontext:{value:null},servename:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});